###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                25/May/2015  20:56:20 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Com #
#                          ponents\osal\common\OSAL_Clock.c                   #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0 #
#                          \Projects\zstack\Samples\ParkingS\CC2530DB\..\..\. #
#                          .\Tools\CC2530DB\f8wCoord.cfg" (-DCPU32MHZ         #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f     #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Samples\ParkingS\CC2530DB\..\..\..\T #
#                          ools\CC2530DB\f8wConfig.cfg" (-DSECURE=0           #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Co #
#                          mponents\osal\common\OSAL_Clock.c" -D ZTOOL_P1 -D  #
#                          COORDINATOR -D MT_TASK -D MT_SYS_FUNC -D           #
#                          MT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG -lC "C:\Texas  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\CoordinatorEB\List\" #
#                           -lA "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4 #
#                          .0\Projects\zstack\Samples\ParkingS\CC2530DB\Coord #
#                          inatorEB\List\" --diag_suppress Pe001,Pa010 -o     #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Samples\ParkingS\CC2530DB\Coordinato #
#                          rEB\Obj\" -e --require_prototypes --debug          #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\" -I "C:\Texas       #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\SOURCE\" -I       #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Samples\ParkingS\CC2530DB\..\..\..\Z #
#                          MAIN\TI2530DB\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\MT\" -I "C:\Texas Instruments\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\ParkingS\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\" -I     #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Samples\ParkingS\CC2530DB\..\..\..\. #
#                          .\..\COMPONENTS\HAL\TARGET\CC2530EB\" -I           #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Samples\ParkingS\CC2530DB\..\..\..\. #
#                          .\..\COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas      #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\OSAL\INCLUDE\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\STACK\AF\" -I "C:\Texas                      #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\STACK\NWK\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\STACK\SEC\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\STACK\SAPI\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\STACK\SYS\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\STACK\ZDO\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\ZMAC\F8W\" -I "C:\Texas                      #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\ZMAC\" -I "C:\Texas                          #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\SERVICES\SADDR\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\SERVICES\SDATA\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\MAC\INCLUDE\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\MAC\HIGH_LEVEL\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\MAC\LOW_LEVEL\srf04\" -I "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\ParkingS\CC2530DB\..\..\..\..\..\COMPO #
#                          NENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I         #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3\8051\INC\" -I "C:\Program Files\IAR            #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\"     #
#                          -Ohz                                               #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pro #
#                          jects\zstack\Samples\ParkingS\CC2530DB\Coordinator #
#                          EB\List\OSAL_Clock.lst                             #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pro #
#                          jects\zstack\Samples\ParkingS\CC2530DB\Coordinator #
#                          EB\Obj\OSAL_Clock.r51                              #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Components\osal\common\OSAL_Clock.c
      1          /**************************************************************************************************
      2            Filename:       OSAL_Clock.c
      3            Revised:        $Date: 2008-12-15 15:42:47 -0800 (Mon, 15 Dec 2008) $
      4            Revision:       $Revision: 18616 $
      5          
      6            Description:    OSAL Clock definition and manipulation functions.
      7          
      8            Copyright 2004-2008 Texas Instruments Incorporated. All rights reserved.
      9          
     10            IMPORTANT: Your use of this Software is limited to those specific rights
     11            granted under the terms of a software license agreement between the user
     12            who downloaded the software, his/her employer (which must be your employer)
     13            and Texas Instruments Incorporated (the "License").  You may not use this
     14            Software unless you agree to abide by the terms of the License. The License
     15            limits your use, and you acknowledge, that the Software may not be modified,
     16            copied or distributed unless embedded on a Texas Instruments microcontroller
     17            or used solely and exclusively in conjunction with a Texas Instruments radio
     18            frequency transceiver, which is integrated into your product.  Other than for
     19            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     20            works of, modify, distribute, perform, display or sell this Software and/or
     21            its documentation for any purpose.
     22          
     23            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     24            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     25            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     26            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     27            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     28            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     29            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     30            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     31            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     32            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     33            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     34          
     35            Should you have any questions regarding your right to use this Software,
     36            contact Texas Instruments Incorporated at www.TI.com.
     37          **************************************************************************************************/
     38          
     39          /*********************************************************************
     40           * INCLUDES
     41           */
     42          
     43          #include "comdef.h"
     44          #include "OnBoard.h"
     45          #include "OSAL.h"
     46          #include "OSAL_Clock.h"
     47          
     48          /*********************************************************************
     49           * MACROS
     50           */
     51          
     52          /*********************************************************************
     53           * CONSTANTS
     54           */
     55          
     56          // (MAXCALCTICKS * 8) + (max remainder) must be <= (uint16 max), 
     57          // so: (8188 * 8) + 24 <= 65535
     58          #define MAXCALCTICKS  ((uint16)(8188))
     59          
     60          #define	BEGYEAR	        2000    //  00:00:00 January 1, 2000
     61          #define	DAY             86400UL // 24 hours * 60 minutes * 60 seconds
     62          #define	IsLeapYear(yr)	(!((yr) % 4) && (((yr) % 100) || !((yr) % 400)))
     63          #define	YearLength(yr)	(IsLeapYear(yr) ? 366 : 365)
     64          
     65          
     66          /*********************************************************************
     67           * TYPEDEFS
     68           */
     69          
     70          /*********************************************************************
     71           * GLOBAL VARIABLES
     72           */
     73          
     74          
     75          /*********************************************************************
     76           * EXTERNAL VARIABLES
     77           */
     78          
     79          /*********************************************************************
     80           * EXTERNAL FUNCTIONS
     81           */
     82          extern uint16 macMcuPrecisionCount(void);
     83          
     84          /*********************************************************************
     85           * LOCAL VARIABLES
     86           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     87          static uint16 previousMacTimerTick = 0;
   \                     previousMacTimerTick:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     88          static uint16 remUsTicks = 0;
   \                     remUsTicks:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     89          static uint16 timeMSec = 0;
   \                     timeMSec:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
     90          
     91          // number of seconds since 0 hrs, 0 minutes, 0 seconds, on the
     92          // 1st of January 2000 UTC

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     93          UTCTime OSAL_timeSeconds = 0;
   \                     OSAL_timeSeconds:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
     94          
     95          /*********************************************************************
     96           * LOCAL FUNCTION PROTOTYPES
     97           */
     98          static uint8 monthLength( uint8 lpyr, uint8 mon );
     99          
    100          static void osalClockUpdate( uint16 elapsedMSec );
    101          
    102          /*********************************************************************
    103           * FUNCTIONS
    104           *********************************************************************/
    105          
    106          /*********************************************************************
    107           * @fn      osalTimeUpdate
    108           *
    109           * @brief   Uses the free running rollover count of the MAC backoff timer;
    110           *          this timer runs freely with a constant 320 usec interval.  The
    111           *          count of 320-usec ticks is converted to msecs and used to update
    112           *          the OSAL clock and Timers by invoking osalClockUpdate() and
    113           *          osalTimerUpdate().  This function is intended to be invoked 
    114           *          from the background, not interrupt level.
    115           *
    116           * @param   None.
    117           *
    118           * @return  None.
    119           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    120          void osalTimeUpdate( void )
   \                     osalTimeUpdate:
    121          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
    122            uint16 tmp;
    123            uint16 ticks320us;
    124            uint16 elapsedMSec = 0;
   \   000005   7E00         MOV     R6,#0x0
   \   000007   7F00         MOV     R7,#0x0
    125          
    126            // Get the free-running count of 320us timer ticks
    127            tmp = macMcuPrecisionCount();
   \   000009                ; Setup parameters for call to function macMcuPrecisionCount
   \   000009   12....       LCALL   ??macMcuPrecisionCount?relay
   \   00000C   8A..         MOV     ?V0 + 0,R2
   \   00000E   8B..         MOV     ?V0 + 1,R3
   \   000010   AC..         MOV     R4,?V0 + 0
   \   000012   AD..         MOV     R5,?V0 + 1
    128            
    129            if ( tmp != previousMacTimerTick )
   \   000014   90....       MOV     DPTR,#previousMacTimerTick
   \   000017   E0           MOVX    A,@DPTR
   \   000018   6C           XRL     A,R4
   \   000019   7003         JNZ     ??osalTimeUpdate_0
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6D           XRL     A,R5
   \                     ??osalTimeUpdate_0:
   \   00001E   7003         JNZ     $+5
   \   000020   02....       LJMP    ??osalTimeUpdate_1 & 0xFFFF
    130            {
    131              // Calculate the elapsed ticks of the free-running timer.
    132              ticks320us = tmp - previousMacTimerTick;
   \   000023   90....       MOV     DPTR,#previousMacTimerTick
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F8           MOV     R0,A
   \   000028   A3           INC     DPTR
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F9           MOV     R1,A
   \   00002B   EC           MOV     A,R4
   \   00002C   C3           CLR     C
   \   00002D   98           SUBB    A,R0
   \   00002E   F5..         MOV     ?V0 + 0,A
   \   000030   ED           MOV     A,R5
   \   000031   99           SUBB    A,R1
   \   000032   F5..         MOV     ?V0 + 1,A
    133            
    134              // Store the MAC Timer tick count for the next time through this function.
    135              previousMacTimerTick = tmp;
   \   000034   90....       MOV     DPTR,#previousMacTimerTick
   \   000037   EC           MOV     A,R4
   \   000038   F0           MOVX    @DPTR,A
   \   000039   A3           INC     DPTR
   \   00003A   ED           MOV     A,R5
   \   00003B   801F         SJMP    ??osalTimeUpdate_2
    136            
    137              /* It is necessary to loop to convert the usecs to msecs in increments so as 
    138               * not to overflow the 16-bit variables.
    139               */
    140              while ( ticks320us > MAXCALCTICKS )
    141              {
    142                ticks320us -= MAXCALCTICKS;
   \                     ??osalTimeUpdate_3:
   \   00003D   E5..         MOV     A,?V0 + 0
   \   00003F   2404         ADD     A,#0x4
   \   000041   F5..         MOV     ?V0 + 0,A
   \   000043   E5..         MOV     A,?V0 + 1
   \   000045   34E0         ADDC    A,#-0x20
   \   000047   F5..         MOV     ?V0 + 1,A
    143                elapsedMSec += MAXCALCTICKS * 8 / 25;
   \   000049   EE           MOV     A,R6
   \   00004A   243C         ADD     A,#0x3c
   \   00004C   FE           MOV     R6,A
   \   00004D   EF           MOV     A,R7
   \   00004E   340A         ADDC    A,#0xa
   \   000050   FF           MOV     R7,A
    144                remUsTicks += MAXCALCTICKS * 8 % 25;
   \   000051   90....       MOV     DPTR,#remUsTicks
   \   000054   E0           MOVX    A,@DPTR
   \   000055   2404         ADD     A,#0x4
   \   000057   F0           MOVX    @DPTR,A
   \   000058   A3           INC     DPTR
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   3400         ADDC    A,#0x0
   \                     ??osalTimeUpdate_2:
   \   00005C   F0           MOVX    @DPTR,A
    145              }
   \   00005D   C3           CLR     C
   \   00005E   E5..         MOV     A,?V0 + 0
   \   000060   94FD         SUBB    A,#-0x3
   \   000062   E5..         MOV     A,?V0 + 1
   \   000064   941F         SUBB    A,#0x1f
   \   000066   50D5         JNC     ??osalTimeUpdate_3
    146            
    147              // update converted number with remaining ticks from loop and the 
    148              // accumulated remainder from loop
    149              tmp = (ticks320us * 8) + remUsTicks;
   \   000068   7403         MOV     A,#0x3
   \   00006A   78..         MOV     R0,#?V0 + 0
   \   00006C   12....       LCALL   ?S_SHL
   \   00006F   90....       MOV     DPTR,#remUsTicks
   \   000072   E0           MOVX    A,@DPTR
   \   000073   25..         ADD     A,?V0 + 0
   \   000075   FC           MOV     R4,A
   \   000076   A3           INC     DPTR
   \   000077   E0           MOVX    A,@DPTR
   \   000078   35..         ADDC    A,?V0 + 1
   \   00007A   FD           MOV     R5,A
    150                
    151              // Convert the 320 us ticks into milliseconds and a remainder
    152              elapsedMSec += tmp / 25;
   \   00007B   EC           MOV     A,R4
   \   00007C   F8           MOV     R0,A
   \   00007D   ED           MOV     A,R5
   \   00007E   F9           MOV     R1,A
   \   00007F   7A19         MOV     R2,#0x19
   \   000081   7B00         MOV     R3,#0x0
   \   000083   12....       LCALL   ?US_DIV_MOD
   \   000086   88..         MOV     ?V0 + 0,R0
   \   000088   89..         MOV     ?V0 + 1,R1
   \   00008A   EE           MOV     A,R6
   \   00008B   25..         ADD     A,?V0 + 0
   \   00008D   FE           MOV     R6,A
   \   00008E   EF           MOV     A,R7
   \   00008F   35..         ADDC    A,?V0 + 1
   \   000091   FF           MOV     R7,A
    153              remUsTicks = tmp % 25;
   \   000092   EC           MOV     A,R4
   \   000093   F8           MOV     R0,A
   \   000094   ED           MOV     A,R5
   \   000095   F9           MOV     R1,A
   \   000096   7A19         MOV     R2,#0x19
   \   000098   7B00         MOV     R3,#0x0
   \   00009A   12....       LCALL   ?US_DIV_MOD
   \   00009D   90....       MOV     DPTR,#remUsTicks
   \   0000A0   EA           MOV     A,R2
   \   0000A1   F0           MOVX    @DPTR,A
   \   0000A2   A3           INC     DPTR
   \   0000A3   EB           MOV     A,R3
   \   0000A4   F0           MOVX    @DPTR,A
    154                  
    155              // Update OSAL Clock and Timers
    156              if ( elapsedMSec )
   \   0000A5   EE           MOV     A,R6
   \   0000A6   7001         JNZ     ??osalTimeUpdate_4
   \   0000A8   EF           MOV     A,R7
   \                     ??osalTimeUpdate_4:
   \   0000A9   6044         JZ      ??osalTimeUpdate_1
    157              {
    158                osalClockUpdate( elapsedMSec );
   \   0000AB   90....       MOV     DPTR,#timeMSec
   \   0000AE   E0           MOVX    A,@DPTR
   \   0000AF   2E           ADD     A,R6
   \   0000B0   F0           MOVX    @DPTR,A
   \   0000B1   A3           INC     DPTR
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   3F           ADDC    A,R7
   \   0000B4   F0           MOVX    @DPTR,A
   \   0000B5   90....       MOV     DPTR,#timeMSec
   \   0000B8   C3           CLR     C
   \   0000B9   E0           MOVX    A,@DPTR
   \   0000BA   94E9         SUBB    A,#-0x17
   \   0000BC   A3           INC     DPTR
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   9403         SUBB    A,#0x3
   \   0000C0   4026         JC      ??osalTimeUpdate_5
   \   0000C2   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   0000C5   12....       LCALL   ?US_DIV_MOD
   \   0000C8   88..         MOV     ?V0 + 0,R0
   \   0000CA   89..         MOV     ?V0 + 1,R1
   \   0000CC   75..00       MOV     ?V0 + 2,#0x0
   \   0000CF   75..00       MOV     ?V0 + 3,#0x0
   \   0000D2   90....       MOV     DPTR,#OSAL_timeSeconds
   \   0000D5   78..         MOV     R0,#?V0 + 0
   \   0000D7   12....       LCALL   ?L_ADD_TO_X
   \   0000DA   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   0000DD   12....       LCALL   ?US_DIV_MOD
   \   0000E0   90....       MOV     DPTR,#timeMSec
   \   0000E3   EA           MOV     A,R2
   \   0000E4   F0           MOVX    @DPTR,A
   \   0000E5   A3           INC     DPTR
   \   0000E6   EB           MOV     A,R3
   \   0000E7   F0           MOVX    @DPTR,A
    159                osalTimerUpdate( elapsedMSec );
   \                     ??osalTimeUpdate_5:
   \   0000E8                ; Setup parameters for call to function osalTimerUpdate
   \   0000E8   EE           MOV     A,R6
   \   0000E9   FA           MOV     R2,A
   \   0000EA   EF           MOV     A,R7
   \   0000EB   FB           MOV     R3,A
   \   0000EC   12....       LCALL   ??osalTimerUpdate?relay
    160              }
    161            }
    162          }
   \                     ??osalTimeUpdate_1:
   \   0000EF                REQUIRE ?Subroutine7
   \   0000EF                ; // Fall through to label ?Subroutine7

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   7F04         MOV     R7,#0x4
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    163          
    164          /*********************************************************************
    165           * @fn      osalClockUpdate
    166           *
    167           * @brief   Updates the OSAL Clock time with elapsed milliseconds.
    168           *
    169           * @param   elapsedMSec - elapsed milliseconds
    170           *
    171           * @return  none
    172           */
    173          static void osalClockUpdate( uint16 elapsedMSec )
    174          {
    175            // Add elapsed milliseconds to the saved millisecond portion of time
    176            timeMSec += elapsedMSec;
    177          
    178            // Roll up milliseconds to the number of seconds
    179            if ( timeMSec > 1000 )
    180            {
    181              OSAL_timeSeconds += timeMSec / 1000;
    182              timeMSec = timeMSec % 1000;
    183            }
    184          }
    185          
    186          /*********************************************************************
    187           * @fn      osal_setClock
    188           *
    189           * @brief   Set the new time.  This will only set the seconds portion
    190           *          of time and doesn't change the factional second counter.
    191           *
    192           * @param   newTime - number of seconds since 0 hrs, 0 minutes,
    193           *                    0 seconds, on the 1st of January 2000 UTC
    194           *
    195           * @return  none
    196           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    197          void osal_setClock( UTCTime newTime )
   \                     osal_setClock:
    198          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   8C..         MOV     ?V0 + 2,R4
   \   00000B   8D..         MOV     ?V0 + 3,R5
    199            OSAL_timeSeconds = newTime;
   \   00000D   90....       MOV     DPTR,#OSAL_timeSeconds
   \   000010   78..         MOV     R0,#?V0 + 0
   \   000012   12....       LCALL   ?L_MOV_TO_X
    200          }
   \   000015   80..         SJMP    ?Subroutine7
    201          
    202          /*********************************************************************
    203           * @fn      osal_getClock
    204           *
    205           * @brief   Gets the current time.  This will only return the seconds
    206           *          portion of time and doesn't include the factional second
    207           *          counter.
    208           *
    209           * @param   none
    210           *
    211           * @return  number of seconds since 0 hrs, 0 minutes, 0 seconds,
    212           *          on the 1st of January 2000 UTC
    213           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    214          UTCTime osal_getClock( void )
   \                     osal_getClock:
    215          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
    216            return ( OSAL_timeSeconds );
   \   000005   90....       MOV     DPTR,#OSAL_timeSeconds
   \   000008   78..         MOV     R0,#?V0 + 0
   \   00000A   12....       LCALL   ?L_MOV_X
   \   00000D   AA..         MOV     R2,?V0 + 0
   \   00000F   AB..         MOV     R3,?V0 + 1
   \   000011   AC..         MOV     R4,?V0 + 2
   \   000013   AD..         MOV     R5,?V0 + 3
   \   000015   80..         SJMP    ?Subroutine7
    217          }
    218          
    219          /*********************************************************************
    220           * @fn      osal_ConvertUTCTime
    221           *
    222           * @brief   Converts UTCTime to UTCTimeStruct
    223           *
    224           * @param   tm - pointer to breakdown struct
    225           *
    226           * @param   secTime - number of seconds since 0 hrs, 0 minutes,
    227           *          0 seconds, on the 1st of January 2000 UTC
    228           *
    229           * @return  none
    230           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    231          void osal_ConvertUTCTime( UTCTimeStruct *tm, UTCTime secTime )
   \                     osal_ConvertUTCTime:
    232          {
   \   000000   74E8         MOV     A,#-0x18
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 24
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
   \   000015   741A         MOV     A,#0x1a
   \   000017   12....       LCALL   ?XSTACK_DISP0_8
   \   00001A   78..         MOV     R0,#?V0 + 4
   \   00001C   12....       LCALL   ?L_MOV_X
    233            // calculate the time less than a day - hours, minutes, seconds
    234            {
    235              uint32 day = secTime % DAY;
   \   00001F   85....       MOV     ?V0 + 0,?V0 + 4
   \   000022   85....       MOV     ?V0 + 1,?V0 + 5
   \   000025   85....       MOV     ?V0 + 2,?V0 + 6
   \   000028   85....       MOV     ?V0 + 3,?V0 + 7
   \   00002B   90....       MOV     DPTR,#__Constant_15180
   \   00002E   78..         MOV     R0,#?V0 + 8
   \   000030   12....       LCALL   ?L_MOV_X
   \   000033   78..         MOV     R0,#?V0 + 0
   \   000035   79..         MOV     R1,#?V0 + 8
   \   000037   12....       LCALL   ?UL_DIV_MOD
    236              tm->seconds = day % 60UL;
   \   00003A   85....       MOV     ?V0 + 12,?V0 + 8
   \   00003D   85....       MOV     ?V0 + 13,?V0 + 9
   \   000040   85....       MOV     ?V0 + 14,?V0 + 10
   \   000043   85....       MOV     ?V0 + 15,?V0 + 11
   \   000046   90....       MOV     DPTR,#__Constant_3c
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?L_MOV_X
   \   00004E   78..         MOV     R0,#?V0 + 12
   \   000050   79..         MOV     R1,#?V0 + 0
   \   000052   12....       LCALL   ?UL_DIV_MOD
   \   000055   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000058   E5..         MOV     A,?V0 + 0
   \   00005A   F0           MOVX    @DPTR,A
    237              tm->minutes = (day % 3600UL) / 60;
   \   00005B   85....       MOV     ?V0 + 12,?V0 + 8
   \   00005E   85....       MOV     ?V0 + 13,?V0 + 9
   \   000061   85....       MOV     ?V0 + 14,?V0 + 10
   \   000064   85....       MOV     ?V0 + 15,?V0 + 11
   \   000067   90....       MOV     DPTR,#__Constant_e10
   \   00006A   78..         MOV     R0,#?V0 + 0
   \   00006C   12....       LCALL   ?L_MOV_X
   \   00006F   78..         MOV     R0,#?V0 + 12
   \   000071   79..         MOV     R1,#?V0 + 0
   \   000073   12....       LCALL   ?UL_DIV_MOD
   \   000076   90....       MOV     DPTR,#__Constant_3c
   \   000079   78..         MOV     R0,#?V0 + 12
   \   00007B   12....       LCALL   ?L_MOV_X
   \   00007E   78..         MOV     R0,#?V0 + 0
   \   000080   79..         MOV     R1,#?V0 + 12
   \   000082   12....       LCALL   ?UL_DIV_MOD
   \   000085   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000088   A3           INC     DPTR
   \   000089   E5..         MOV     A,?V0 + 0
   \   00008B   F0           MOVX    @DPTR,A
    238              tm->hour = day / 3600UL;
   \   00008C   90....       MOV     DPTR,#__Constant_e10
   \   00008F   78..         MOV     R0,#?V0 + 0
   \   000091   12....       LCALL   ?L_MOV_X
   \   000094   78..         MOV     R0,#?V0 + 8
   \   000096   79..         MOV     R1,#?V0 + 0
   \   000098   12....       LCALL   ?UL_DIV_MOD
   \   00009B   12....       LCALL   ?Subroutine1 & 0xFFFF
    239            }
   \                     ??CrossCallReturnLabel_2:
   \   00009E   E5..         MOV     A,?V0 + 8
   \   0000A0   F0           MOVX    @DPTR,A
    240          
    241            // Fill in the calendar - day, month, year
    242            {
    243              uint16 numDays = secTime / DAY;
   \   0000A1   90....       MOV     DPTR,#__Constant_15180
   \   0000A4   78..         MOV     R0,#?V0 + 0
   \   0000A6   12....       LCALL   ?L_MOV_X
   \   0000A9   78..         MOV     R0,#?V0 + 4
   \   0000AB   79..         MOV     R1,#?V0 + 0
   \   0000AD   12....       LCALL   ?UL_DIV_MOD
   \   0000B0   AE..         MOV     R6,?V0 + 4
   \   0000B2   AF..         MOV     R7,?V0 + 5
    244              tm->year = BEGYEAR;
   \   0000B4   85..82       MOV     DPL,?XSP + 0
   \   0000B7   85..83       MOV     DPH,?XSP + 1
   \   0000BA   E0           MOVX    A,@DPTR
   \   0000BB   2405         ADD     A,#0x5
   \   0000BD   F5..         MOV     ?V0 + 0,A
   \   0000BF   A3           INC     DPTR
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   3400         ADDC    A,#0x0
   \   0000C3   F5..         MOV     ?V0 + 1,A
   \   0000C5   85..82       MOV     DPL,?V0 + 0
   \   0000C8   F583         MOV     DPH,A
   \   0000CA   74D0         MOV     A,#-0x30
   \   0000CC   F0           MOVX    @DPTR,A
   \   0000CD   A3           INC     DPTR
   \   0000CE   7407         MOV     A,#0x7
   \   0000D0   8018         SJMP    ??osal_ConvertUTCTime_0
    245              while ( numDays >= YearLength( tm->year ) )
    246              {
    247                numDays -= YearLength( tm->year );
   \                     ??osal_ConvertUTCTime_1:
   \   0000D2   786D         MOV     R0,#0x6d
   \                     ??osal_ConvertUTCTime_2:
   \   0000D4   C3           CLR     C
   \   0000D5   EE           MOV     A,R6
   \   0000D6   98           SUBB    A,R0
   \   0000D7   FE           MOV     R6,A
   \   0000D8   EF           MOV     A,R7
   \   0000D9   9401         SUBB    A,#0x1
   \   0000DB   FF           MOV     R7,A
    248                tm->year++;
   \   0000DC   85..82       MOV     DPL,?V0 + 0
   \   0000DF   85..83       MOV     DPH,?V0 + 1
   \   0000E2   E0           MOVX    A,@DPTR
   \   0000E3   2401         ADD     A,#0x1
   \   0000E5   F0           MOVX    @DPTR,A
   \   0000E6   A3           INC     DPTR
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   3400         ADDC    A,#0x0
   \                     ??osal_ConvertUTCTime_0:
   \   0000EA   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   0000ED   F5..         MOV     ?V0 + 2,A
   \   0000EF   7026         JNZ     ??osal_ConvertUTCTime_3
   \   0000F1   EC           MOV     A,R4
   \   0000F2   F8           MOV     R0,A
   \   0000F3   ED           MOV     A,R5
   \   0000F4   F9           MOV     R1,A
   \   0000F5   7A64         MOV     R2,#0x64
   \   0000F7   7B00         MOV     R3,#0x0
   \   0000F9   12....       LCALL   ?US_DIV_MOD
   \   0000FC   EA           MOV     A,R2
   \   0000FD   7001         JNZ     ??osal_ConvertUTCTime_4
   \   0000FF   EB           MOV     A,R3
   \                     ??osal_ConvertUTCTime_4:
   \   000100   7011         JNZ     ??osal_ConvertUTCTime_5
   \   000102   EC           MOV     A,R4
   \   000103   F8           MOV     R0,A
   \   000104   ED           MOV     A,R5
   \   000105   F9           MOV     R1,A
   \   000106   7A90         MOV     R2,#-0x70
   \   000108   7B01         MOV     R3,#0x1
   \   00010A   12....       LCALL   ?US_DIV_MOD
   \   00010D   EA           MOV     A,R2
   \   00010E   7001         JNZ     ??osal_ConvertUTCTime_6
   \   000110   EB           MOV     A,R3
   \                     ??osal_ConvertUTCTime_6:
   \   000111   7004         JNZ     ??osal_ConvertUTCTime_3
   \                     ??osal_ConvertUTCTime_5:
   \   000113   786E         MOV     R0,#0x6e
   \   000115   8002         SJMP    ??osal_ConvertUTCTime_7
   \                     ??osal_ConvertUTCTime_3:
   \   000117   786D         MOV     R0,#0x6d
   \                     ??osal_ConvertUTCTime_7:
   \   000119   C3           CLR     C
   \   00011A   EE           MOV     A,R6
   \   00011B   98           SUBB    A,R0
   \   00011C   EF           MOV     A,R7
   \   00011D   9401         SUBB    A,#0x1
   \   00011F   402A         JC      ??osal_ConvertUTCTime_8
   \   000121   E5..         MOV     A,?V0 + 2
   \   000123   70AD         JNZ     ??osal_ConvertUTCTime_1
   \   000125   EC           MOV     A,R4
   \   000126   F8           MOV     R0,A
   \   000127   ED           MOV     A,R5
   \   000128   F9           MOV     R1,A
   \   000129   7A64         MOV     R2,#0x64
   \   00012B   7B00         MOV     R3,#0x0
   \   00012D   12....       LCALL   ?US_DIV_MOD
   \   000130   EA           MOV     A,R2
   \   000131   7001         JNZ     ??osal_ConvertUTCTime_9
   \   000133   EB           MOV     A,R3
   \                     ??osal_ConvertUTCTime_9:
   \   000134   7011         JNZ     ??osal_ConvertUTCTime_10
   \   000136   EC           MOV     A,R4
   \   000137   F8           MOV     R0,A
   \   000138   ED           MOV     A,R5
   \   000139   F9           MOV     R1,A
   \   00013A   7A90         MOV     R2,#-0x70
   \   00013C   7B01         MOV     R3,#0x1
   \   00013E   12....       LCALL   ?US_DIV_MOD
   \   000141   EA           MOV     A,R2
   \   000142   7001         JNZ     ??osal_ConvertUTCTime_11
   \   000144   EB           MOV     A,R3
   \                     ??osal_ConvertUTCTime_11:
   \   000145   708B         JNZ     ??osal_ConvertUTCTime_1
   \                     ??osal_ConvertUTCTime_10:
   \   000147   786E         MOV     R0,#0x6e
   \   000149   8089         SJMP    ??osal_ConvertUTCTime_2
    249              }
    250          
    251              tm->month = 0;
   \                     ??osal_ConvertUTCTime_8:
   \   00014B   85..82       MOV     DPL,?XSP + 0
   \   00014E   85..83       MOV     DPH,?XSP + 1
   \   000151   E0           MOVX    A,@DPTR
   \   000152   2404         ADD     A,#0x4
   \   000154   F5..         MOV     ?V0 + 2,A
   \   000156   A3           INC     DPTR
   \   000157   E0           MOVX    A,@DPTR
   \   000158   3400         ADDC    A,#0x0
   \   00015A   F5..         MOV     ?V0 + 3,A
   \   00015C   E4           CLR     A
   \   00015D   85..82       MOV     DPL,?V0 + 2
   \   000160   85..83       MOV     DPH,?V0 + 3
   \   000163   8012         SJMP    ??osal_ConvertUTCTime_12
    252              while ( numDays >= monthLength( IsLeapYear( tm->year ), tm->month ) )
    253              {
    254                numDays -= monthLength( IsLeapYear( tm->year ), tm->month );
   \                     ??osal_ConvertUTCTime_13:
   \   000165   7900         MOV     R1,#0x0
   \                     ??osal_ConvertUTCTime_14:
   \   000167                ; Setup parameters for call to function monthLength
   \   000167   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00016A   FE           MOV     R6,A
   \   00016B   EF           MOV     A,R7
   \   00016C   9400         SUBB    A,#0x0
   \   00016E   FF           MOV     R7,A
    255                tm->month++;
   \   00016F   85..82       MOV     DPL,?V0 + 2
   \   000172   85..83       MOV     DPH,?V0 + 3
   \   000175   E0           MOVX    A,@DPTR
   \   000176   04           INC     A
   \                     ??osal_ConvertUTCTime_12:
   \   000177   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   00017A   7026         JNZ     ??osal_ConvertUTCTime_15
   \   00017C   EC           MOV     A,R4
   \   00017D   F8           MOV     R0,A
   \   00017E   ED           MOV     A,R5
   \   00017F   F9           MOV     R1,A
   \   000180   7A64         MOV     R2,#0x64
   \   000182   7B00         MOV     R3,#0x0
   \   000184   12....       LCALL   ?US_DIV_MOD
   \   000187   EA           MOV     A,R2
   \   000188   7001         JNZ     ??osal_ConvertUTCTime_16
   \   00018A   EB           MOV     A,R3
   \                     ??osal_ConvertUTCTime_16:
   \   00018B   7011         JNZ     ??osal_ConvertUTCTime_17
   \   00018D   EC           MOV     A,R4
   \   00018E   F8           MOV     R0,A
   \   00018F   ED           MOV     A,R5
   \   000190   F9           MOV     R1,A
   \   000191   7A90         MOV     R2,#-0x70
   \   000193   7B01         MOV     R3,#0x1
   \   000195   12....       LCALL   ?US_DIV_MOD
   \   000198   EA           MOV     A,R2
   \   000199   7001         JNZ     ??osal_ConvertUTCTime_18
   \   00019B   EB           MOV     A,R3
   \                     ??osal_ConvertUTCTime_18:
   \   00019C   7004         JNZ     ??osal_ConvertUTCTime_15
   \                     ??osal_ConvertUTCTime_17:
   \   00019E   7901         MOV     R1,#0x1
   \   0001A0   8002         SJMP    ??osal_ConvertUTCTime_19
   \                     ??osal_ConvertUTCTime_15:
   \   0001A2   7900         MOV     R1,#0x0
   \                     ??osal_ConvertUTCTime_19:
   \   0001A4                ; Setup parameters for call to function monthLength
   \   0001A4   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   0001A7   EF           MOV     A,R7
   \   0001A8   9400         SUBB    A,#0x0
   \   0001AA   402B         JC      ??osal_ConvertUTCTime_20
   \   0001AC   12....       LCALL   ?Subroutine6 & 0xFFFF
    256              }
   \                     ??CrossCallReturnLabel_12:
   \   0001AF   70B4         JNZ     ??osal_ConvertUTCTime_13
   \   0001B1   EC           MOV     A,R4
   \   0001B2   F8           MOV     R0,A
   \   0001B3   ED           MOV     A,R5
   \   0001B4   F9           MOV     R1,A
   \   0001B5   7A64         MOV     R2,#0x64
   \   0001B7   7B00         MOV     R3,#0x0
   \   0001B9   12....       LCALL   ?US_DIV_MOD
   \   0001BC   EA           MOV     A,R2
   \   0001BD   7001         JNZ     ??osal_ConvertUTCTime_21
   \   0001BF   EB           MOV     A,R3
   \                     ??osal_ConvertUTCTime_21:
   \   0001C0   7011         JNZ     ??osal_ConvertUTCTime_22
   \   0001C2   EC           MOV     A,R4
   \   0001C3   F8           MOV     R0,A
   \   0001C4   ED           MOV     A,R5
   \   0001C5   F9           MOV     R1,A
   \   0001C6   7A90         MOV     R2,#-0x70
   \   0001C8   7B01         MOV     R3,#0x1
   \   0001CA   12....       LCALL   ?US_DIV_MOD
   \   0001CD   EA           MOV     A,R2
   \   0001CE   7001         JNZ     ??osal_ConvertUTCTime_23
   \   0001D0   EB           MOV     A,R3
   \                     ??osal_ConvertUTCTime_23:
   \   0001D1   7092         JNZ     ??osal_ConvertUTCTime_13
   \                     ??osal_ConvertUTCTime_22:
   \   0001D3   7901         MOV     R1,#0x1
   \   0001D5   8090         SJMP    ??osal_ConvertUTCTime_14
    257          
    258              tm->day = numDays;
   \                     ??osal_ConvertUTCTime_20:
   \   0001D7   12....       LCALL   ?Subroutine1 & 0xFFFF
    259            }
   \                     ??CrossCallReturnLabel_3:
   \   0001DA   A3           INC     DPTR
   \   0001DB   EE           MOV     A,R6
   \   0001DC   F0           MOVX    @DPTR,A
    260          }
   \   0001DD   7402         MOV     A,#0x2
   \   0001DF   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001E2   7F10         MOV     R7,#0x10
   \   0001E4   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F8           MOV     R0,A
   \   000008   A3           INC     DPTR
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   F583         MOV     DPH,A
   \   00000C   8882         MOV     DPL,R0
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   85..82       MOV     DPL,?V0 + 2
   \   000003   85..83       MOV     DPH,?V0 + 3
   \   000006   E0           MOVX    A,@DPTR
   \   000007   FA           MOV     R2,A
   \   000008   12....       LCALL   ??monthLength?relay
   \   00000B   E9           MOV     A,R1
   \   00000C   F8           MOV     R0,A
   \   00000D   C3           CLR     C
   \   00000E   EE           MOV     A,R6
   \   00000F   98           SUBB    A,R0
   \   000010   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000003   A3           INC     DPTR
   \   000004   A3           INC     DPTR
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000004   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   85..82       MOV     DPL,?V0 + 0
   \   000003   85..83       MOV     DPH,?V0 + 1
   \   000006   E0           MOVX    A,@DPTR
   \   000007   FC           MOV     R4,A
   \   000008   A3           INC     DPTR
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   FD           MOV     R5,A
   \   00000B   EC           MOV     A,R4
   \   00000C   5403         ANL     A,#0x3
   \   00000E   22           RET
    261          
    262          /*********************************************************************
    263           * @fn      monthLength
    264           *
    265           * @param   lpyr - 1 for leap year, 0 if not
    266           *
    267           * @param   mon - 0 - 11 (jan - dec)
    268           *
    269           * @return  returns the number of days in a month
    270           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    271          static uint8 monthLength( uint8 lpyr, uint8 mon )
   \                     monthLength:
    272          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   \   000000   E9           MOV     A,R1
   \   000001   FB           MOV     R3,A
    273            uint8 days = 31;
   \   000002   791F         MOV     R1,#0x1f
    274          
    275          	if ( mon == 1 ) // feb
   \   000004   7401         MOV     A,#0x1
   \   000006   6A           XRL     A,R2
   \   000007   7006         JNZ     ??monthLength_0
    276          		days = ( 28 + lpyr );
   \   000009   741C         MOV     A,#0x1c
   \   00000B   2B           ADD     A,R3
   \   00000C   F9           MOV     R1,A
   \   00000D   800D         SJMP    ??monthLength_1
    277            else
    278            {
    279              if ( mon > 6 )
   \                     ??monthLength_0:
   \   00000F   EA           MOV     A,R2
   \   000010   C3           CLR     C
   \   000011   9407         SUBB    A,#0x7
   \   000013   4001         JC      ??monthLength_2
    280                mon--;
   \   000015   1A           DEC     R2
    281          
    282              if ( (mon % 2) == 1 )
   \                     ??monthLength_2:
   \   000016   EA           MOV     A,R2
   \   000017   A2E0         MOV     C,0xE0 /* A   */.0
   \   000019   5001         JNC     ??monthLength_1
    283                days = 30;
   \   00001B   19           DEC     R1
    284            }
    285          
    286          	return ( days );
   \                     ??monthLength_1:
   \   00001C   02....       LJMP    ?BRET
    287          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   90....       MOV     DPTR,#timeMSec
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F8           MOV     R0,A
   \   000005   A3           INC     DPTR
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F9           MOV     R1,A
   \   000008   7AE8         MOV     R2,#-0x18
   \   00000A   7B03         MOV     R3,#0x3
   \   00000C   22           RET

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_15180:
   \   000000   80510100     DD 86400

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3c:
   \   000000   3C000000     DD 60

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_e10:
   \   000000   100E0000     DD 3600

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osalTimeUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osalTimeUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_setClock?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_setClock

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_getClock?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_getClock

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_ConvertUTCTime?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_ConvertUTCTime

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??monthLength?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    monthLength

   Maximum stack usage in bytes:

     Function                  ISTACK PSTACK XSTACK
     --------                  ------ ------ ------
     monthLength                   0      0     26
     osalTimeUpdate                0      0     12
       -> macMcuPrecisionCount     0      0     24
       -> osalTimerUpdate          0      0     24
     osal_ConvertUTCTime           1      0     30
       -> monthLength              0      0     52
       -> monthLength              0      0     52
     osal_getClock                 0      0     12
     osal_setClock                 0      0     12


   Segment part sizes:

     Function/Label              Bytes
     --------------              -----
     previousMacTimerTick           2
     remUsTicks                     2
     timeMSec                       2
     OSAL_timeSeconds               4
     osalTimeUpdate               239
     ?Subroutine7                   5
     osal_setClock                 23
     osal_getClock                 23
     osal_ConvertUTCTime          487
     ?Subroutine4                   4
     ?Subroutine5                  15
     ?Subroutine2                  17
     ?Subroutine1                   6
     ?Subroutine0                   5
     ?Subroutine6                  15
     monthLength                   31
     ?Subroutine3                  13
     __Constant_15180               4
     __Constant_3c                  4
     __Constant_e10                 4
     ??osalTimeUpdate?relay         6
     ??osal_setClock?relay          6
     ??osal_getClock?relay          6
     ??osal_ConvertUTCTime?relay    6
     ??monthLength?relay            6

 
 883 bytes in segment BANKED_CODE
  30 bytes in segment BANK_RELAYS
  12 bytes in segment XDATA_ROM_C
  10 bytes in segment XDATA_Z
 
 913 bytes of CODE  memory
   0 bytes of CONST memory (+ 12 bytes shared)
  10 bytes of XDATA memory

Errors: none
Warnings: none
